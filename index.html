<!DOCTYPE html>
<html>
<head>
    <title>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏°‡∏ô‡∏ó‡πå</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; }
        #map { height: 100vh; width: 100%; } /* ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
        .info-box {
            position: absolute; bottom: 20px; left: 10px; right: 10px;
            background: white; padding: 10px; border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 1000;
            text-align: center; font-family: sans-serif;
        }
    </style>
</head>
<body>

    <div id="map"></div>
    <div class="info-box">
        <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á</strong><br>
        <button onclick="focusVan('van1')">üìç ‡∏Ñ‡∏±‡∏ô‡∏ó‡∏µ‡πà 1</button>
        <button onclick="focusVan('van2')">üìç ‡∏Ñ‡∏±‡∏ô‡∏ó‡∏µ‡πà 2</button>
        <hr>
        <span id="van1-status">üöê ‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span><br>
        <span id="van2-status">üöê ‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // 1. ‡∏ß‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°)
        const firebaseConfig = {
            apiKey: "AIzaSyBL4nhltSeXZTtgShoqgvWG4tcyb92XOzw",
            authDomain: "my-apartment-shuttle.firebaseapp.com",
            databaseURL: "https://my-apartment-shuttle-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "my-apartment-shuttle",
            storageBucket: "my-apartment-shuttle.firebasestorage.app",
            messagingSenderId: "808566202899",
            appId: "1:808566202899:web:5626ae23c0df6335d455e6"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏≠‡∏ô‡∏∏‡∏™‡∏≤‡∏ß‡∏£‡∏µ‡∏¢‡πå‡∏ä‡∏±‡∏¢‡∏Ø - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ---
        const map = L.map('map').setView([13.7649, 100.5383], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏±‡∏ô
        const vans = {
            van1: { marker: null, path: L.polyline([], {color: 'blue'}).addTo(map), statusId: 'van1-status' },
            van2: { marker: null, path: L.polyline([], {color: 'red'}).addTo(map), statusId: 'van2-status' }
        };

        const vanIcon = L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/3066/3066259.png',
            iconSize: [40, 40],
            iconAnchor: [20, 20]
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏ñ
        function focusVan(id) {
            const v = vans[id];
            if (v.marker) {
                map.panTo(v.marker.getLatLng());
                v.marker.openPopup();
            } else {
                alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö");
            }
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase ---
        function trackShuttle(id) {
            db.ref('shuttles/' + id).on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) return;

                const pos = [data.lat, data.lng];
                const v = vans[id];

                if (data.active) {
                    // 1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Marker
                    if (!v.marker) {
                        v.marker = L.marker(pos, {icon: vanIcon}).addTo(map).bindPopup("‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ó‡∏µ‡πà " + (id === 'van1' ? '1' : '2'));
                    } else {
                        v.marker.setLatLng(pos);
                    }

                    // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Polyline)
                    v.path.addLatLng(pos);

                    // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                    document.getElementById(v.statusId).innerText = `üöê ‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ó‡∏µ‡πà ${id.slice(-1)}: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πà‡∏á`;
                    document.getElementById(v.statusId).style.color = "green";
                } else {
                    document.getElementById(v.statusId).innerText = `üöê ‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ó‡∏µ‡πà ${id.slice(-1)}: ‡∏à‡∏≠‡∏î/‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå`;
                    document.getElementById(v.statusId).style.color = "red";
                }
            });
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á 2 ‡∏Ñ‡∏±‡∏ô
        trackShuttle('van1');
        trackShuttle('van2');

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ---
        setInterval(() => {
            const now = new Date();
            const mins = now.getMinutes();
            const secs = now.getSeconds();

            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà 00 ‡∏´‡∏£‡∏∑‡∏≠ 30 (‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà 0 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
            if ((mins === 0 || mins === 30) && secs === 0) {
                console.log("‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤...");
                vans.van1.path.setLatLngs([]);
                vans.van2.path.setLatLngs([]);
            }
        }, 1000); // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    </script>
</body>
</html>
